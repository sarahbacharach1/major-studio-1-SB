<!DOCTYPE html>
<meta charset="utf-8">

<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<style>
    body {
        background-color: rgb(0, 0, 0);
        color: white;
    }

    .bubbles {
        stroke-width: 0.2px;
        stroke: #f4bb00;
    }

    .bubbles:hover {
        stroke: white;
    }

    .colour:hover {
        fill: #ffc400;
    }

    .axis {
        font: 14px sans-serif;
        stroke: white;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: white;
        stroke-width: 1px;
        shape-rendering: crispEdges;
    }

    .axis text {
        fill: white;
        /* Set text color to white */
    }

    .toolTip {
        position: absolute;
        display: none;
        min-width: 80px;
        height: auto;
        background: none repeat scroll 0 0 #ffffff;
        border: 1px solid #ffffff;
        padding: 14px;
        text-align: left;
    }
</style>
<div id="my_dataviz"></div>

<body>
    <script>

        var margin = { top: 60, right: 80, bottom: 100, left: 50 },
            width = 900 - margin.left - margin.right,
            height = 680 - margin.top - margin.bottom;

        var yOffset = 60;

        var svg = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", width + margin.left + margin.right + 600)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + (margin.top + yOffset) + ")");

        svg.style("font-family", "Gill Sans, sans-serif");


        svg.append("text")
            .attr("x", width / 2)
            .attr("y", -margin.top / 2 - 20)
            .attr("text-anchor", "middle")
            .style("font-size", "24px")
            .style("font-weight", "bold")
            .style("fill", "#EADDCA")
            .text("Does Size Matter?");

        svg.append("text")
            .attr("x", width / 2)
            .attr("y", -margin.top / 2 + 10)
            .attr("text-anchor", "middle")
            .style("font-size", "18px")
            .style("fill", "#EADDCA")
            .text("Exploring the NGA archives and its relationship with the golden ratio");


        // Add a white background rectangle behind the text
        var textBox = svg.append("rect")
            .attr("x", 886) // Adjust the x-position to place the box next to the graph
            .attr("y", 30) // Adjust the y-position to align the box vertically
            .attr("width", 200) // Set the width of the box
            .attr("height", 180) // Set the height of the box
            .attr("fill", "#7393B3"); // Set the fill color to white

        // Add a foreignObject element within the white box to contain the wrapped text
        var foreignObject = svg.append("foreignObject")
            .attr("x", 900) // Adjust the x-position to place the text inside the box
            .attr("y", 40) // Adjust the y-position to align the text vertically
            .attr("width", 180) // Adjust the width to fit inside the box
            .attr("height", 420); // Adjust the height to fit inside the box

        // Add a div element within the foreignObject for HTML content (the wrapped text)
        var div = foreignObject.append("xhtml:div")
            .style("font-size", "14px")
            .style("font-family", "Gill Sans, sans-serif")
            .style("color", "#EADDCA")
            .style("text-align", "left")
            .html("<b>Golden Ratio</b><br>With a proportion equal to xÂ²=x+1, the golden ratio in art creates a balanced relationship that the mind's eye loves. More precisely, it is about obtaining a precise ratio between the different parts of a work, an image, or an object.");

        d3.csv("cleaned.csv", function (data) {
            // Filter the data to include only points with y-values <= 2.0
            data = data.filter(function (d) {
                return d.Ratio <= 2.0;
            });

            // Filter the data to include only points with x-values <= 200
            data = data.filter(function (d) {
                return d.Width <= 200;
            });

            var x = d3.scaleLinear()
                .domain([0, 200])
                .range([0, width])
                .nice();

            svg.append("text")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom - 10)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("dy", "3.5em")
                .style("fill", "white")
                .text("Width");

            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x))
                .selectAll(".tick text")
                .style("fill", "white");

            var y = d3.scaleLinear()
                .domain([0, 2.0])
                .range([height, 0])
                .nice();

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", height / 2)
                .attr("y", -margin.left + 10)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("fill", "white")
                .text("Dimension (Height/Width)");

            svg.append("g")
                .call(d3.axisLeft(y))
                .selectAll(".tick text")
                .style("fill", "white");

            var z = d3.scaleLinear()
                .domain([200000, 1310000000])
                .range([2, 10]);

            var myColor = d3.scaleOrdinal()
                .range(d3.schemeSet2);

            var tooltip = d3.select("#my_dataviz")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "none")
                .style("border-radius", "5px")
                .style("padding", "10px")
                .style("color", "white")
                .style("text-align", "center")
                .style("position", "absolute")
                .style("min-width", "80px")
                .style("height", "auto")
                .style("border", "white")
                .style("background", "white")
                .style("padding", "14px");

            var showTooltip = function (d) {
                tooltip
                    .transition()
                    .duration(200);
                tooltip
                    .style("opacity", 1)
                    .html("Objectid: " + d.Objectid + "<br>" + "Ratio:" + d.Ratio + "<br>" + "Width:" + d.Width + "<br>" + "Height:" + d.Height + "<br>" + "Year:" + d.Year)
                    .style("top", (d3.mouse(this)[1] + 30) + "px");
            };
            var moveTooltip = function (d) {
                tooltip
                    .style("left", (d3.mouse(this)[0] + 30) + "px")
                    .style("top", (d3.mouse(this)[1] + 30) + "px");
            };
            var hideTooltip = function (d) {
                tooltip
                    .transition()
                    .duration(200)
                    .style("opacity", 0);
            };

            // Add lines and labels on the y-axis
            var yLines = [0.5, 0.7, 0.9, 1.0, 1.1, 1.3, 1.5];
            var yLabels = ["1x2", "Golden Ratio", "3x4", "Square", "4x3", "Golden Ratio", "2x1"];

            for (var i = 0; i < yLines.length; i++) {
                svg.append("line")
                    .attr("x1", x(0))  // Start the line from the left edge
                    .attr("x2", x(200))  // Extend the line to the right edge
                    .attr("y1", y(yLines[i]))
                    .attr("y2", y(yLines[i]))
                    .attr("stroke", "white")
                    .attr("stroke-dasharray", "4");

                svg.append("text")
                    .attr("x", x(200) + 10)  // Position the label to the right of the graph
                    .attr("y", y(yLines[i]))
                    .attr("dy", 4) // Adjust the vertical position
                    .style("font-size", "12px")
                    .style("text-anchor", "start")  // Align text to the left
                    .style("font-weight", "bold")  // Make the text bold
                    .style("fill", "white")
                    .text(yLabels[i]);
            }

            svg.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("class", "bubbles")
                .attr("cx", function (d) { return x(d.Width); })
                .attr("cy", function (d) { return y(d.Ratio); })
                .attr("r", function (d) { return z(d.Height) * 0.5; })
                .style("fill", "lightgold")
                .style("fill-opacity", 0.6)
                .on("mouseover", showTooltip)
                .on("mousemove", moveTooltip)
                .on("mouseleave", hideTooltip);
        });

    </script>
</body>

</html>
